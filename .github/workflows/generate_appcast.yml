name: release-build
on:
  push:
    tags:
      - "s*.*.*"
  #workflow_dispatch:
  #inputs:
  #  name:
  #    Description: 'Build message'
  #    default: 'Hello'
  #    required: false
jobs:
  generate-appcast:
    strategy:
      fail-fast: false
      matrix:
        cfg:
          #- { os: windows-latest }
          - { os: macos-12       }

    name: ${{matrix.cfg.os}}

    runs-on: ${{matrix.cfg.os}}
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Download dmg file
        run: |
          curl https://swiftray.s3.ap-northeast-1.amazonaws.com/mac/swiftray_1.1.3.dmg -o swiftray_1.1.3.dmg
      
      - name: Install Sparkle
        run: |
          brew install sparkle
      
      - name: Get signing key
        env: 
          SPARKLE_SIGNING_KEY: ${{ secrets.SPARKLE_ED25519_SIGNING_KEY }}
        run: |
          echo $SPARKLE_SIGNING_KEY > sparkle_key.pem
      
      #- name: Install signing key
      #  run:
      #    security create-keychain sparkle.keychain
      #    security default-keychain -s sparkle.keychain
      #    security show-keychain-info sparkle.keychain

      - name: Try signing
        run: |
          /usr/local/Caskroom/sparkle/*/bin/sign_update -f sparkle_key.pem swiftray_1.1.3.dmg

      #- name: Run python
